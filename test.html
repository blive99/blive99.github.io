<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FUCKIDPLUS3.0</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ff8c00;--muted:#9aa6b2}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,‡∏™‡∏ß‡∏±‡∏™,Arial;background:linear-gradient(180deg,#071229 0%, #071a2f 100%);color:#e6eef6}
    .app{display:grid;grid-template-columns:300px 1fr;gap:16px;height:100vh;padding:18px}
    header{grid-column:1/-1;text-align:center;margin-bottom:6px}
    h1{margin:0;font-size:22px;color:var(--accent);letter-spacing:2px}
    .sidebar{background:var(--card);padding:12px;border-radius:12px;overflow:auto}
    .groups{display:flex;flex-direction:column;gap:8px}
    .group{padding:10px;border-radius:8px;background:transparent;cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
    .group:hover{background:rgba(255,255,255,0.02)}
    .channels{margin-top:12px;display:grid;grid-template-columns:1fr;gap:8px}
    .channel{display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
    .channel img{width:48px;height:32px;object-fit:cover;border-radius:4px}
    .channel .meta{font-size:13px}
    main{background:transparent;display:flex;flex-direction:column;gap:12px}
    .player-card{background:var(--card);border-radius:12px;padding:12px;min-height:320px;display:flex;flex-direction:column}
    video{width:100%;height:420px;background:black;border-radius:8px;outline:1px solid rgba(0,0,0,0.4)}
    .controls{display:flex;gap:8px;align-items:center;margin-top:8px}
    .controls button,input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px;border-radius:8px}
    .forms{display:flex;gap:12px;flex-wrap:wrap}
    .form{flex:1;min-width:240px;background:var(--card);padding:12px;border-radius:10px}
    footer{grid-column:1/-1;text-align:center;color:var(--muted);font-size:12px}
    .small{font-size:12px;color:var(--muted)}
    .btn{background:var(--accent);border:none;color:#000;padding:8px 12px;border-radius:8px;cursor:pointer}
    .list-empty{padding:12px;color:var(--muted);text-align:center}
    @media(max-width:900px){.app{grid-template-columns:1fr;grid-auto-rows:auto}header{margin-bottom:10px}}
  </style>
  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
</head>
<body>
  <div class="app">
    <header><h1>FUCKIDPLUS3.0</h1></header>

    <aside class="sidebar">
      <div class="small">‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ä‡πà‡∏≠‡∏á</div>
      <div id="groups" class="groups"></div>
      <hr style="opacity:.06;margin:12px 0" />
      <div class="small">‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î</div>
      <div id="channels" class="channels"></div>
      <div id="emptyHint" class="list-empty" style="display:none">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ ‚Äî ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</strong> ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</div>
    </aside>

    <main>
      <div class="player-card">
        <video id="player" controls crossorigin playsinline></video>
        <div class="controls">
          <div id="nowPlaying" class="small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á</div>
          <div style="flex:1"></div>
          <button id="btnPrev" class="btn" style="display:none">‚èÆÔ∏è</button>
          <button id="btnNext" class="btn" style="display:none">‚è≠Ô∏è</button>
        </div>
      </div>

      <div class="form" style="display:flex;flex-direction:column;gap:8px">
        <strong>‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö m3u8 / mp4 / ts / mpd)</strong>
        <div class="forms">
          <input id="fieldName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô MONOMAX1)" />
          <input id="fieldUrl" placeholder="URL (http(s)://...)" />
          <input id="fieldLogo" placeholder="URL ‡∏£‡∏π‡∏õ‡πÇ‡∏•‡πÇ‡∏Å‡πâ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" />
          <input id="fieldGroup" placeholder="‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏´‡∏°‡∏ß‡∏î (‡πÄ‡∏ä‡πà‡∏ô üì∫ VIP SPORT)" />
        </div>
        <div class="forms">
          <select id="fieldType"><option value="auto">‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•)</option><option value="m3u8">m3u8</option><option value="mp4">mp4</option><option value="ts">ts</option><option value="mpd">mpd</option></select>
          <input id="fieldMPDKey" placeholder="(‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô .mpd) ‡πÉ‡∏™‡πà keyid:hexkey (‡πÄ‡∏ä‡πà‡∏ô 6187...:5119...)" />
          <button id="btnAdd" class="btn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
        </div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input type="file" id="importFile" accept=".m3u,.m3u8" />
          <button id="btnExport" class="btn">‡πÄ‡∏ã‡∏ü‡πÄ‡∏õ‡πá‡∏ô .m3u</button>
          <button id="btnClear" style="background:#ff4444;color:#fff;border:none;border-radius:8px">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
        <div class="small">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏î‡πâ‡∏ß‡∏¢ CORS / ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</div>
      </div>

      <div class="form">
        <strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πà‡∏ô)</strong>
        <div id="allList" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px;margin-top:8px"></div>
      </div>

    </main>

    <footer>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡∏ü‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô m3u (UTF-8). ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå .m3u ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤</footer>
  </div>

<script>
// --- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ) ---
const defaultM3U = `###SPORT###
#EXTINF:-1 tvg-id="" tvg-logo="https://www.img03.xyz/assets/img/ch_logo/Monomax_Sport01.png" group-title="üì∫ VIP SPORT",MONOMAX1
#EXTVLCOPT:http-user-agent=Mozilla/5.0 (Linux; Android 7.1.2; TV BOX Build/NHG47L) AppleWebKit/537.36 (KHTML ‡πÄ‡∏ä‡πà‡∏ô Gecko) Chrome/56.0.2924.87 Safari/537.36
#EXTVLCOPT:http-referrer=https://bestcommt2.github.io
http://bestcommt2.github.io/m3u8/monomax1.m3u8
#EXTINF:-1 group-title="üì∫ VIP SPORT" tvg-logo="https://www.jsports.co.jp/img/icon/ch1.png", J SPORTS 1
https://mt01.utako.moe/js1/index.m3u8
###PREMIUM PLAY TV###
#EXTINF:-1 group-title="üì∫ PREMIUM PLAY TV" tvg-logo="https://i.ibb.co/B53tBWkh/logoizaamovie.png",IZAAMOVIE
http://49.0.64.96:8007/IZAA
###BallThai###
#EXTINF:-1 tvg-name="PlaysportsFootball2" tvg-logo="https://www.img10.xyz/assets/img/ch_logo/AISplay-sport2.jpg" group-title="üì∫ ‡πÑ‡∏ó‡∏¢‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå",PLAY SPORTS FOOTBALL 2
#EXTVLCOPT:http-referrer=https://olympic-embed.ais-vidnt.com
#EXTVLCOPT:http-user-agent=Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1
https://49-231-34-108-rewriter.ais-vidnt.com/ais/play/anevia/live/eds/TL002/HLS/TL002.m3u8 
###‡∏ó‡∏µ‡∏ß‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ï‡∏≠‡∏•‡πÑ‡∏ó‡∏¢###
#EXTINF:-1 tvg-id="TSports7.th" tvg-name="T Sports 7" tvg-logo="https://58-64-52-73-rewriter.ais-vidnt.com/ais/play/origin/LIVE/channelicon/T-SPorts_7_Final.png" group-title="üì∫ ‡∏ó‡∏µ‡∏ß‡∏µ‡∏î‡∏¥‡∏à‡∏¥‡∏ï‡∏≠‡∏•",T Sports 7
#KODIPROP:inputstreamaddon=inputstream.adaptive
#KODIPROP:inputstream.adaptive.manifest_type=dash
#KODIPROP:inputstream.adaptive.license_type=clearkey
#KODIPROP:inputstream.adaptive.license_key=6187523f92b9475bb5b192f70cef1342:5119311f482144d58dacabc5bc1fa4ba
https://udn-streamer1.cdn.3bbtv.com:8443/3bb/live/7/7.mpd`;

// --- data structures ---
let channels = []; // {name,url,logo,group,type,mpdKey}
let currentGroup = null;
let hls = null;
let dashPlayer = null;
const player = document.getElementById('player');

// helpers
function detectType(url, forced){
  if(forced && forced!=='auto') return forced;
  const u = url.split('?')[0].toLowerCase();
  if(u.endsWith('.m3u8')) return 'm3u8';
  if(u.endsWith('.mpd')) return 'mpd';
  if(u.endsWith('.mp4')) return 'mp4';
  if(u.endsWith('.ts')) return 'ts';
  return 'unknown';
}

function saveToStorage(){ localStorage.setItem('fuckidplus_playlist', JSON.stringify(channels)); }
function loadFromStorage(){ const s = localStorage.getItem('fuckidplus_playlist'); if(s) channels = JSON.parse(s); else parseM3U(defaultM3U); renderAll(); }

// parse a user-supplied m3u-ish text.
function parseM3U(text){
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l!=="");
  let curGroup = 'Ungrouped';
  let lastMeta = null;
  for(let i=0;i<lines.length;i++){
    const l = lines[i];
    if(l.startsWith('###') && l.endsWith('###')){ curGroup = l.replace(/#/g,'').trim(); continue; }
    if(l.startsWith('#EXTINF')){
      lastMeta = l;
      continue;
    }
    if(l.startsWith('#KODIPROP:')){
      // attach to lastMeta by adding to it
      if(lastMeta) lastMeta += '\n'+l;
      continue;
    }
    if(l.startsWith('#EXTVLCOPT')){ if(lastMeta) lastMeta += '\n'+l; continue; }
    if(!l.startsWith('#')){
      const url = l;
      const meta = lastMeta || '';
      // extract name after comma
      let name = '';
      const commaIdx = meta.indexOf(',');
      if(commaIdx>=0) name = meta.slice(commaIdx+1).trim();
      // extract attributes
      const logoMatch = meta.match(/tvg-logo\s*=\s*"([^"]+)"/i) || meta.match(/tvg-logo=([^\s,]+)/i);
      const logo = logoMatch ? logoMatch[1] : '';
      const groupMatch = meta.match(/group-title\s*=\s*"([^"]+)"/i);
      const group = groupMatch ? groupMatch[1] : curGroup;
      const idMatch = meta.match(/tvg-id\s*=\s*"([^"]+)"/i);
      const tvgid = idMatch ? idMatch[1] : '';
      // KODIPROP license
      let mpdKey = '';
      const kodipropMatch = meta.match(/license_key\s*=\s*([^\s]+)/i);
      if(kodipropMatch) mpdKey = kodipropMatch[1].trim();
      channels.push({name: name||url, url, logo, group, tvgid, mpdKey, type: detectType(url)});
      lastMeta = null;
    }
  }
}

// render UI
function renderGroups(){
  const groupsEl = document.getElementById('groups'); groupsEl.innerHTML='';
  const groups = [...new Set(channels.map(c=>c.group||'Ungrouped'))];
  if(groups.length===0) groups.push('Ungrouped');
  groups.forEach(g=>{
    const el = document.createElement('div'); el.className='group'; el.textContent = g; el.onclick = ()=>{ currentGroup=g; renderChannels(); renderGroups(); };
    if(g===currentGroup) el.style.outline='2px solid rgba(255,140,0,0.18)';
    groupsEl.appendChild(el);
  });
}

function renderChannels(){
  const cont = document.getElementById('channels'); cont.innerHTML='';
  const list = channels.filter(c=> (currentGroup?c.group===currentGroup:true));
  if(list.length===0){ document.getElementById('emptyHint').style.display='block'; return; } else document.getElementById('emptyHint').style.display='none';
  list.forEach(ch=>{
    const el = document.createElement('div'); el.className='channel';
    const img = document.createElement('img'); img.src = ch.logo || 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="48" height="32"><rect width="100%" height="100%" fill="%23071a2f"/></svg>';
    const meta = document.createElement('div'); meta.className='meta'; meta.innerHTML = `<div style="font-weight:600">${ch.name}</div><div class="small">${ch.url.split('?')[0]}</div>`;
    el.appendChild(img); el.appendChild(meta);
    el.onclick = ()=>{ playChannel(ch); document.getElementById('nowPlaying').textContent = ch.name; };
    cont.appendChild(el);
  });
}

function renderAll(){
  renderGroups(); renderChannels();
  const allList = document.getElementById('allList'); allList.innerHTML='';
  channels.forEach(ch=>{
    const card = document.createElement('div'); card.className='channel'; card.style.background='rgba(255,255,255,0.02)';
    const img = document.createElement('img'); img.src = ch.logo || '';
    const meta = document.createElement('div'); meta.className='meta'; meta.innerHTML = `<div style="font-weight:600">${ch.name}</div><div class="small">${ch.group||''}</div>`;
    card.appendChild(img); card.appendChild(meta);
    card.onclick = ()=>{ playChannel(ch); document.getElementById('nowPlaying').textContent = ch.name; };
    allList.appendChild(card);
  });
  saveToStorage();
}

// play logic
function clearPlayers(){ if(hls){ hls.destroy(); hls=null; } if(dashPlayer){ try{ dashPlayer.reset(); }catch(e){} dashPlayer=null; }
}

function playChannel(ch){
  clearPlayers();
  const url = ch.url;
  const type = detectType(url, ch.type);
  player.pause();
  player.removeAttribute('src');
  player.load();
  if(type==='m3u8'){
    if(Hls.isSupported()){
      hls = new Hls(); hls.loadSource(url); hls.attachMedia(player); hls.on(Hls.Events.MANIFEST_PARSED, ()=>player.play());
    }else if(player.canPlayType('application/vnd.apple.mpegurl')){ player.src = url; player.play(); }
  }else if(type==='mpd'){
    // dash.js
    dashPlayer = dashjs.MediaPlayer().create();
    if(ch.mpdKey){
      // expect mpdKey like keyid:hexkey
      try{
        const [kid, key] = ch.mpdKey.split(':');
        const clearkeys = {};
        clearkeys[kid] = key;
        dashPlayer.setProtectionData({"org.w3.clearkey": {"clearkeys": clearkeys}});
      }catch(e){ console.warn('invalid mpd key format', e); }
    }
    dashPlayer.initialize(player, url, true);
  }else{
    // mp4 or ts or unknown - use direct src
    player.src = url; player.play().catch(e=>console.warn(e));
  }
}

// UI hookups
document.getElementById('btnAdd').addEventListener('click', ()=>{
  const name = document.getElementById('fieldName').value.trim();
  const url = document.getElementById('fieldUrl').value.trim();
  const logo = document.getElementById('fieldLogo').value.trim();
  const group = document.getElementById('fieldGroup').value.trim() || 'Ungrouped';
  const type = document.getElementById('fieldType').value;
  const mpdKey = document.getElementById('fieldMPDKey').value.trim();
  if(!url) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏ URL');
  const ch = {name: name||url, url, logo, group, mpdKey, type: detectType(url,type)};
  channels.push(ch); renderAll(); document.getElementById('fieldName').value=''; document.getElementById('fieldUrl').value=''; document.getElementById('fieldLogo').value='';
});

// import .m3u file
document.getElementById('importFile').addEventListener('change', (ev)=>{
  const f = ev.target.files[0]; if(!f) return;
  const reader = new FileReader(); reader.onload = e=>{
    try{ parseM3U(e.target.result); renderAll(); alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }
    catch(err){ alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: '+err.message); }
  }; reader.readAsText(f, 'utf-8');
});

// export to m3u
function buildM3U(){
  let out = '#EXTM3U\n';
  // group by group
  const byGroup = {};
  channels.forEach(c=>{ const g = c.group||'Ungrouped'; if(!byGroup[g]) byGroup[g]=[]; byGroup[g].push(c); });
  for(const g of Object.keys(byGroup)){
    out += `###${g}###\n`;
    byGroup[g].forEach(c=>{
      // build EXTINF
      let meta = '#EXTINF:-1 ';
      if(c.tvgid) meta += `tvg-id="${c.tvgid}" `;
      if(c.logo) meta += `tvg-logo="${c.logo}" `;
      if(c.group) meta += `group-title="${c.group}" `;
      meta += `,${c.name}\n`;
      out += meta;
      if(c.mpdKey) out += `#KODIPROP:inputstreamadaptive.license_key=${c.mpdKey}\n`;
      out += c.url + '\n';
    });
  }
  return out;
}

document.getElementById('btnExport').addEventListener('click', ()=>{
  const text = buildM3U(); const blob = new Blob([text],{type:'text/plain;charset=utf-8'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'playlist.m3u'; document.body.appendChild(a); a.click(); a.remove();
});

// clear
document.getElementById('btnClear').addEventListener('click', ()=>{ if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){ channels=[]; saveToStorage(); renderAll(); }});

// load initial
loadFromStorage();
</script>
</body>
</html>
